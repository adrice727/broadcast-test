<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Broadcast Test</title>
    <script src="library/hls.js"></script>
    <script src="js/api.js"></script>
</head>

<body>

    <button id="start" onclick="start()">Start Broadcast</button>
    <button id="stop" onclick="stop()">Stop Broadcast</button>
    <video id="video"></video>

    <script>
        if (Hls.isSupported()) {

            var start = () => {

                const play = (videoData) => {

                    let { broadcastId, broadcastUrl } = videoData;

                    let video = document.getElementById('video');
                    video.setAttribute('broadcast-id', videoData.broadcastId);
                    let hls = new Hls();
                    hls.loadSource(videoData.broadcastUrl);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        video.play();
                    });

                };


                /** URL should not be accessed until 50 seconds later, after the 
                 * initiation of the HLS broadcast, due to the delay between the 
                 * HLS broadcast and the live broadcast from the OpenTok session.
                 */
                const delay = 1000 * 55;

                api.getBroadcastUrl()
                    .then(videoData => {
                        console.log(videoData);
                        setTimeout(() => { play(videoData) }, delay);
                    });
            };

            var stop = () => {


            };
        }
    </script>
</body>

</html>